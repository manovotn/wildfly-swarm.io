<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="WildFly Swarm Official Website"><link rel="icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" title="RSS Feed for wildfly-swarm.io" href="/rss.xml"><title>Fault tolerance and resilience | Thorntail</title><link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/css/headers/header-default.css"><link rel="stylesheet" href="/assets/css/footers/footer-v1.css"><link rel="stylesheet" href="/assets/plugins/animate.css"><link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css"><link rel="stylesheet" href="/assets/plugins/parallax-slider/css/parallax-slider.css"><link rel="stylesheet" href="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.css"><link rel="stylesheet" href="/assets/css/theme-colors/default.css" id="style_color"><link rel="stylesheet" href="/assets/css/theme-skins/dark.css"><link rel="stylesheet" href="/assets/css/custom.css"><link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800"><link rel="stylesheet" media="screen" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" media="screen" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css"><link rel="stylesheet" href="/css/site.css"></head><body><div class="header"><div class="container"><a href="/" class="logo"><img src="/images/swarm_icon_32x32.png" class="icon"><span style="font-size:20px;vertical-align:middle;color:#555;margin-left:10px">WildFly Swarm</span></a><div class="topbar"><ul class="loginbar pull-right"><li class="hoverSelector"><a href="http://jboss.org">JBoss.org</a></li><li class="topbar-devider"></li><li class="hoverSelector"><a href="http://redhat.com">Red Hat</a></li><li class="hoverSelector"><img style="margin-left:10px" src="https://img.shields.io/maven-central/v/io.thorntail/bom.svg?maxAge=604800"></li></ul></div><button type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" class="navbar-toggle"><span class="sr-only">Toggle Navigation</span><span class="fa fa-bars"></span></button></div><div id="navbar" aria-expanded="false" class="navbar-collapse mega-menu navbar-responsive-collapse collapse"><div class="container"><ul class="nav navbar-nav"><li><a href="/generator" class="dropdown-toggle">Generator</a></li><li><a href="/archive">Blog</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/community">Community</a></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Resources</a><ul class="dropdown-menu"><li><a href="/downloads">Downloads</a></li><li><a href="/resources">Presentations</a></li></ul></li></ul></div></div></div><div class="wrapper"><div class="breadcrumbs"><div class="container"><h1>Fault tolerance and resilience</h1></div></div><section class="section"><div class="container"><div class="row"><div class="col-sm-8"><div class="sect1">
<h2 id="_turn_the_web_frontend_into_a_service">Turn the web frontend into a service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point the web frontend still resides with WildFly. So we turn it into a Swarm service before we proceed,
to be able to run it locally. Make sure to also advertise it as a service, like we did in Step 3.
Once this is done we don’t need WildFly anymore. It’s good to terminate the process to avoid port conflicts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When you turn the everest module into a swarm service,
you change the packaging of <code>war</code> to <code>jar</code>. This also requires you to move the web resources from <code>src/main/webapp</code> to <code>src/main/resources</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_introducing_fault_injection_techniques_and_hystrix_for_resilience">Introducing fault-injection techniques and hystrix for resilience.</h3>
<div class="paragraph">
<p>Before thinking about resilience it&#8217;s actually useful to inject faults to demonstrate the need for enhanced fault handling capabilities. <a href="/tutorial/toxy">Appendix A</a> contains some information on how to use a fault-injection proxy to easily achieve this.</p>
</div>
<div class="paragraph">
<p>Once we can simulate faults, we implement a circuit breaker using Hystrix and complete this activity by installing the <a href="/tutorial/hystrix">Hystrix dashboard</a> to monitor IPC interactions and the system state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Hystrix runs the command in it’s own thread pool. Doing that in a EE environment requires you to think twice about what that demarcation actually means.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/step-5.png" alt="step 5.png">
</div>
<div class="title">Figure 1. Fault detection and handling</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Bulkheads and circuit breaking (hystrix)</p>
</li>
<li>
<p>Fault injection techniques</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tasks">Tasks</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Start each service, but this time include the web frontend that moved from WildFly:
<code>java -Dswarm.project.stage=production -Dswarm.bind.address=&lt;PUBLIC_IP&gt; -Dconsul.host=&lt;CONSUL_IP&gt; -jar target/everest-web-swarm.jar</code></p>
</li>
<li>
<p>Focus on a single service, for instance the order service and it’s client invocation. (The client to the order service is the web frontend)</p>
</li>
<li>
<p>Redirect traffic through the fault injection proxy. For the sake of simplicity you may just change the service lookup URL in <code>ConsulDiscovery.java</code></p>
</li>
<li>
<p>Prepare the <a href="/tutorial/toxy">Fault-injection proxy</a> to introduce random errors (i.e. HTTP 503, see <a href="/tutorial/toxy">Appendix A</a>)</p>
</li>
<li>
<p>Use the web frontend to order books and watch it fail randomly</p>
</li>
<li>
<p>Add the hystrix dependency to the maven pom.xml (<code>everest</code> module)</p>
</li>
<li>
<p>Add a hystrix command to the order client that can handle (i.e. compensate) the faults</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outcome">Outcome</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>You can run the web frontend using java -jar (no need for WildFly deployment anymore)</p>
</li>
<li>
<p>After adding the circuit breaker, your service client you handle the faults gracefully</p>
</li>
<li>
<p>The web frontend remains operational, the service doesn’t cascade through the system</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation">Documentation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Netflix/Hystrix/wiki">Hystrix Overview</a></p>
</li>
<li>
<p><a href="https://github.com/Netflix/Hystrix/wiki/Getting-Started">Hystrix API</a></p>
</li>
<li>
<p><a href="https://github.com/ReactiveX/RxJava/wiki/Observable">Observable API</a></p>
</li>
<li>
<p><a href="http://docs.couchbase.com/developer/java-2.0/observables.html">A good intro to Observables</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alternative_activities">Alternative Activities</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Caching of the catalog service responses to fallback gracefully</p>
</li>
<li>
<p>Examine possible circuit thresholds (i.e. at what point do we permanently open the circuit)?</p>
</li>
<li>
<p>Replace the home baked service lookup for the frontend with the topology service. It’s bound to JNDI (see WildFly Swarm documentation)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>
<div class="row">
  <div class="col-md-6">
<a href="/tutorial/step-4" class="btn btn-primary"><i class="fa fa-chevron-left" aria-hidden="true"></i>Step 4: Environment abstractions</a>
  </div>
  <div class="col-md-6">
  <a href="/tutorial/step-6" class="btn btn-primary">Step 6: Load balancing and failover
<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
  </div>
</div>
</p>
</div>
</div>
</div></div><div class="col-sm-3 col-sm-offset-1"><div class="sidebar panel panel-default"><ul><li><a href="/tutorial">Introduction</a></li><li><a href="/tutorial/sources">Source Code</a></li><li><a href="/tutorial/example-app">Example Application</a></li><li><a href="/tutorial/prerequisites">Prerequisites</a></li><li><a href="/tutorial/step-0">Step 0: A manageable codebase</a></li><li><a href="/tutorial/step-1">Step 1: Services the old way</a></li><li><a href="/tutorial/step-2">Step 2: Right-size your runtime</a></li><li><a href="/tutorial/step-3">Step 3: Container API, Fractions and Deployments</a></li><li><a href="/tutorial/step-4">Step 4: Environment specific configuration</a></li><li><a href="/tutorial/step-5">Step 5: Fault tolerance and resilience</a></li><li><a href="/tutorial/step-6">Step 6: Load balancing and failover</a></li><li><a href="/tutorial/toxy">Appendix A: Fault-injection proxy</a></li><li><a href="/tutorial/hystrix">Appendix B: Hystrix Dashboard</a></li><li class="last"><a href="/tutorial/reading">Reading on Microservices </a></li></ul></div></div></div><div class="row"><div class="col-sm-8"><div id="disqus_thread"><script> var disqus_config = function () { this.page.url = PAGE_URL; this.page.identifier = PAGE_IDENTIFIER;}; (function() { var d = document, s = d.createElement('script'); s.src = '//wildflyswarm.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); 
</script></div></div></div></div></section></div><div class="footer-v1"><div class="footer"><div class="container"><div class="row"><div class="col-sm-6 md-margin-bottom-40"><p class="text-center"><Copyright>2016 - 2018 <a href="http://redhat.com">Red Hat, Inc.</a> | WildFly Swarm is Open Source Software</Copyright></p></div><div class="col-sm-6 md-margin-bottom-40"><p class="text-center"><span>We rely on the
<a href='http://www.ej-technologies.com/products/jprofiler/overview.html'>
Java profiler from EJ Technologies
</a><br/>
<img src='https://www.ej-technologies.com/images/product_banners/jprofiler_medium.png'/></span></p></div></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-83419890-2', 'auto');
ga('send', 'pageview');

ga('create', 'UA-6435340-8', 'auto');
ga('send', 'pageview');
</script><script type="text/javascript" src="/assets/js/highlight.pack.js"></script><script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script><script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script><script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script><script type="text/javascript" src="/assets/plugins/back-to-top.js"></script><script type="text/javascript" src="/assets/plugins/smoothScroll.js"></script><script type="text/javascript" src="/assets/plugins/parallax-slider/js/modernizr.js"></script><script type="text/javascript" src="/assets/plugins/parallax-slider/js/jquery.cslider.js"></script><script type="text/javascript" src="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.js"></script><script type="text/javascript" src="/assets/js/custom.js"></script><script type="text/javascript" src="/assets/js/app.js"></script><script type="text/javascript" src="/assets/js/plugins/owl-carousel.js"></script><script type="text/javascript" src="/assets/js/plugins/style-switcher.js"></script><script type="text/javascript" src="/assets/js/plugins/parallax-slider.js"></script><script>(function() {

  jQuery(document).ready(function() {
    App.init();
    OwlCarousel.initOwlCarousel();
    StyleSwitcher.initStyleSwitcher();
    ParallaxSlider.initParallaxSlider();

    hljs.initHighlightingOnLoad();
  });

})();
</script></body></html>